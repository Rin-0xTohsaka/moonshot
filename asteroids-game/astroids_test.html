<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Asteroids Game</title>
    <style>
        body {
            margin: 0;
            overflow: hidden;
            background-color: black;
            color: white;
            font-family: Arial, sans-serif;
        }
        canvas {
            display: block;
        }
        #gameOver, #score, #powerUp {
            position: absolute;
            font-size: 24px;
        }
        #gameOver {
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 48px;
            display: none;
        }
        #score {
            top: 10px;
            left: 10px;
        }
        #powerUp {
            top: 40px;
            left: 10px;
        }
    </style>
</head>
<body>
    <canvas id="gameCanvas"></canvas>
    <div id="gameOver">GAME OVER</div>
    <div id="score">Score: 0</div>
    <div id="powerUp"></div>
    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const gameOverEl = document.getElementById('gameOver');
        const scoreEl = document.getElementById('score');
        const powerUpEl = document.getElementById('powerUp');

        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;

        let gameOver = false;
        let score = 0;

        class Ship {
            constructor() {
                this.x = canvas.width / 2;
                this.y = canvas.height / 2;
                this.radius = 15;
                this.angle = 0;
                this.rotation = 0;
                this.thrusting = false;
                this.thrust = { x: 0, y: 0 };
                this.bullets = [];
                this.shield = false;
                this.rapidFire = false;
                this.bulletRange = 1;
                this.spreadShot = false;
                this.lives = 3;
                this.activePowerUp = null;
            }

            draw() {
                ctx.save();
                ctx.translate(this.x, this.y);
                ctx.rotate(-this.angle);

                ctx.strokeStyle = 'white';
                ctx.lineWidth = 2;
                ctx.beginPath();
                ctx.moveTo(this.radius, 0);
                ctx.lineTo(-this.radius, -this.radius / 2);
                ctx.lineTo(-this.radius, this.radius / 2);
                ctx.closePath();
                ctx.stroke();

                if (this.shield) {
                    ctx.strokeStyle = 'rgba(0, 255, 255, 0.5)';
                    ctx.beginPath();
                    ctx.arc(0, 0, this.radius * 1.5, 0, Math.PI * 2);
                    ctx.stroke();
                }

                ctx.restore();

                if (this.thrusting) {
                    ctx.save();
                    ctx.translate(this.x, this.y);
                    ctx.rotate(-this.angle);
                    ctx.strokeStyle = 'orange';
                    ctx.beginPath();
                    ctx.moveTo(-this.radius, 0);
                    ctx.lineTo(-this.radius - 10, 0);
                    ctx.stroke();
                    ctx.restore();
                }
            }

            update() {
                this.angle += this.rotation;

                if (this.thrusting) {
                    this.thrust.x += 0.1 * Math.cos(this.angle);
                    this.thrust.y -= 0.1 * Math.sin(this.angle);
                } else {
                    this.thrust.x *= 0.99;
                    this.thrust.y *= 0.99;
                }

                this.x += this.thrust.x;
                this.y += this.thrust.y;

                // Wrap around screen
                if (this.x < 0) this.x = canvas.width;
                if (this.x > canvas.width) this.x = 0;
                if (this.y < 0) this.y = canvas.height;
                if (this.y > canvas.height) this.y = 0;

                this.bullets = this.bullets.filter(bullet => bullet.isActive());
                this.bullets.forEach(bullet => bullet.update());
            }

            shoot() {
                const bulletSpeed = 5;
                if (this.rapidFire || this.bullets.length === 0) {
                    if (this.spreadShot) {
                        for (let i = -1; i <= 1; i++) {
                            const angle = this.angle + i * 0.2;
                            const bulletX = this.x + this.radius * Math.cos(angle);
                            const bulletY = this.y - this.radius * Math.sin(angle);
                            this.bullets.push(new Bullet(bulletX, bulletY, angle, bulletSpeed, this.bulletRange, this.activePowerUp));
                        }
                    } else {
                        const bulletX = this.x + this.radius * Math.cos(this.angle);
                        const bulletY = this.y - this.radius * Math.sin(this.angle);
                        this.bullets.push(new Bullet(bulletX, bulletY, this.angle, bulletSpeed, this.bulletRange, this.activePowerUp));
                    }
                }
            }
        }

        class Bullet {
            constructor(x, y, angle, speed, range, powerUpType) {
                this.x = x;
                this.y = y;
                this.speed = speed;
                this.dx = Math.cos(angle) * speed;
                this.dy = -Math.sin(angle) * speed;
                this.lifespan = 50 * range;
                
                // Set bullet properties based on power-up type
                switch(powerUpType) {
                    case 'rapidFire':
                        this.radius = 1.5;
                        this.color = 'yellow';
                        break;
                    case 'bulletRange':
                        this.radius = 2;
                        this.color = 'magenta';
                        break;
                    case 'spreadShot':
                        this.radius = 2.5;
                        this.color = 'orange';
                        break;
                    default:
                        this.radius = 2;
                        this.color = 'white';
                }
            }

            draw() {
                ctx.fillStyle = this.color;
                ctx.beginPath();
                ctx.arc(this.x, this.y, this.radius, 0, Math.PI * 2);
                ctx.fill();
            }

            update() {
                this.x += this.dx;
                this.y += this.dy;

                if (this.x < 0) this.x = canvas.width;
                if (this.x > canvas.width) this.x = 0;
                if (this.y < 0) this.y = canvas.height;
                if (this.y > canvas.height) this.y = 0;

                this.lifespan--;
            }

            isActive() {
                return this.lifespan > 0;
            }
        }

        class Asteroid {
            constructor(x, y, radius) {
                this.x = x;
                this.y = y;
                this.radius = radius;
                this.speed = Math.random() * 2 + 1;
                this.angle = Math.random() * Math.PI * 2;
                this.vertices = Math.floor(Math.random() * 7) + 8;
                this.offsets = [];
                for (let i = 0; i < this.vertices; i++) {
                    this.offsets.push(Math.random() * 0.4 + 0.8);
                }
            }

            draw() {
                ctx.strokeStyle = 'white';
                ctx.lineWidth = 2;
                ctx.beginPath();
                for (let i = 0; i < this.vertices; i++) {
                    const angle = (i / this.vertices) * Math.PI * 2;
                    const x = this.x + this.radius * this.offsets[i] * Math.cos(angle);
                    const y = this.y + this.radius * this.offsets[i] * Math.sin(angle);
                    if (i === 0) ctx.moveTo(x, y);
                    else ctx.lineTo(x, y);
                }
                ctx.closePath();
                ctx.stroke();
            }

            update() {
                this.x += Math.cos(this.angle) * this.speed;
                this.y += Math.sin(this.angle) * this.speed;

                if (this.x < 0 - this.radius) this.x = canvas.width + this.radius;
                if (this.x > canvas.width + this.radius) this.x = 0 - this.radius;
                if (this.y < 0 - this.radius) this.y = canvas.height + this.radius;
                if (this.y > canvas.height + this.radius) this.y = 0 - this.radius;
            }
        }

        class PowerUp {
            constructor() {
                this.x = Math.random() * canvas.width;
                this.y = Math.random() * canvas.height;
                this.radius = 10;
                this.type = ['shield', 'rapidFire', 'extraLife', 'bulletRange', 'spreadShot'][Math.floor(Math.random() * 5)];
                this.color = {
                    shield: 'cyan',
                    rapidFire: 'yellow',
                    extraLife: 'green',
                    bulletRange: 'magenta',
                    spreadShot: 'orange'
                }[this.type];
                this.duration = 10000; // 10 seconds
            }

            draw() {
                ctx.fillStyle = this.color;
                ctx.beginPath();
                ctx.arc(this.x, this.y, this.radius, 0, Math.PI * 2);
                ctx.fill();
            }
        }

        const ship = new Ship();
        let asteroids = [];
        let powerUps = [];

        function createAsteroids(count) {
            for (let i = 0; i < count; i++) {
                const x = Math.random() * canvas.width;
                const y = Math.random() * canvas.height;
                const radius = Math.random() * 30 + 20;
                asteroids.push(new Asteroid(x, y, radius));
            }
        }

        function distanceBetweenPoints(x1, y1, x2, y2) {
            return Math.sqrt(Math.pow(x2 - x1, 2) + Math.pow(y2 - y1, 2));
        }

        function checkCollision(obj1, obj2) {
            return distanceBetweenPoints(obj1.x, obj1.y, obj2.x, obj2.y) < obj1.radius + obj2.radius;
        }

        function spawnPowerUp() {
            if (Math.random() < 0.005 && powerUps.length < 3) { // 0.5% chance per frame, max 3 power-ups
                powerUps.push(new PowerUp());
            }
        }

        function activatePowerUp(type) {
            ship.activePowerUp = type;
            switch(type) {
                case 'shield':
                    ship.shield = true;
                    setTimeout(() => {
                        ship.shield = false;
                        ship.activePowerUp = null;
                    }, 10000);
                    break;
                case 'rapidFire':
                    ship.rapidFire = true;
                    setTimeout(() => {
                        ship.rapidFire = false;
                        ship.activePowerUp = null;
                    }, 10000);
                    break;
                case 'extraLife':
                    ship.lives++;
                    ship.activePowerUp = null;
                    break;
                case 'bulletRange':
                    ship.bulletRange = 2;
                    setTimeout(() => {
                        ship.bulletRange = 1;
                        ship.activePowerUp = null;
                    }, 10000);
                    break;
                case 'spreadShot':
                    ship.spreadShot = true;
                    setTimeout(() => {
                        ship.spreadShot = false;
                        ship.activePowerUp = null;
                    }, 10000);
                    break;
            }
            powerUpEl.textContent = `Active: ${type}`;
            setTimeout(() => powerUpEl.textContent = '', 10000);
        }

        function gameLoop() {
            ctx.fillStyle = 'black';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            if (!gameOver) {
                spawnPowerUp();

                ship.update();
                ship.draw();

                ship.bullets.forEach(bullet => bullet.draw());

                asteroids = asteroids.filter(asteroid => {
                    asteroid.update();
                    asteroid.draw();

                    if (checkCollision(ship, asteroid) && !ship.shield) {
                        ship.lives--;
                        if (ship.lives <= 0) {
                            gameOver = true;
                            gameOverEl.style.display = 'block';
                        } else {
                            // Respawn the ship
                            ship.x = canvas.width / 2;
                            ship.y = canvas.height / 2;
                            ship.thrust = { x: 0, y: 0 };
                        }
                        return false;
                    }

                    for (let bullet of ship.bullets) {
                        if (checkCollision(bullet, asteroid)) {
                            score += Math.floor(100 / asteroid.radius);
                            scoreEl.textContent = `Score: ${score} | Lives: ${ship.lives}`;
                            bullet.lifespan = 0;

                            if (asteroid.radius > 20) {
                                const newRadius = asteroid.radius / 2;
                                asteroids.push(new Asteroid(asteroid.x, asteroid.y, newRadius));
                                asteroids.push(new Asteroid(asteroid.x, asteroid.y, newRadius));
                            }

                            return false;
                        }
                    }

                    return true;
                });

                powerUps = powerUps.filter(powerUp => {
                    powerUp.draw();
                    if (checkCollision(ship, powerUp)) {
                        activatePowerUp(powerUp.type);
                        return false;
                    }
                    return true;
                });

                if (asteroids.length === 0) {
                    createAsteroids(5);
                }
            }

            requestAnimationFrame(gameLoop);
        }

        document.addEventListener('keydown', (e) => {
            if (gameOver) return;
            if (e.key === 'ArrowLeft') ship.rotation = 0.1;
            if (e.key === 'ArrowRight') ship.rotation = -0.1;
            if (e.key === 'ArrowUp') ship.thrusting = true;
            if (e.key === ' ') ship.shoot();
        });
        
        document.addEventListener('keyup', (e) => {
            if (gameOver) return;
            if (e.key === 'ArrowLeft' || e.key === 'ArrowRight') ship.rotation = 0;
            if (e.key === 'ArrowUp') ship.thrusting = false;
        });

        // Handle window resizing
        window.addEventListener('resize', () => {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
        });

        // Initialize the game
        createAsteroids(5);
        gameLoop();
    </script>
</body>
</html>